<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MR.T Cafe - Food Order</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(0,0,0,0.5)), 
                  url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1600') center/cover fixed;
      min-height: 100vh;
      padding: 20px;
      padding-top: 80px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: white;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: fadeInDown 1s ease-out;
    }

    .tagline {
      text-align: center;
      color: #ffd700;
      font-size: 1.2rem;
      margin-bottom: 30px;
      font-style: italic;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .cart-float-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
      z-index: 1000;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .cart-float-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 32px rgba(102, 126, 234, 0.7);
    }

    .cart-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #dc3545;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      border: 2px solid white;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        animation: fadeIn 0.3s ease;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 1.5rem;
      margin: 0;
    }

    .close-modal {
      background: transparent;
      border: none;
      color: white;
      font-size: 1.8rem;
      cursor: pointer;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .close-modal:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(90deg);
    }
    
    #locationModal .modal-content {
        max-width: 350px;
        padding: 20px;
    }
    
    #locationModal .modal-content > h2 {
        color: #333;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.3rem;
    }
    
    #locationModal select, #locationModal input {
        width: 100%;
        padding: 10px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
        background-color: white;
    }
    
    #locationModal label {
        font-weight: bold;
        color: #555;
        margin-bottom: 5px;
        display: block;
    }

    .location-actions {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 20px;
    }

    .location-actions button {
        flex-grow: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    
    #cancelLocation {
        background: #f0f0f0;
        color: #333;
    }
    
    #confirmLocation {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .cart-body {
      padding: 20px;
    }

    .customer-info-modal {
      margin-bottom: 20px;
      border: 1px solid #eee;
      padding: 15px;
      border-radius: 10px;
      background-color: #f9f9f9;
    }

    .customer-info-modal label {
      display: block;
      font-weight: bold;
      color: #555;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }

    .customer-info-modal input, .customer-info-modal select {
      width: 100%;
      padding: 10px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      background-color: white;
    }

    .mobile-input-group {
      transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
      overflow: hidden;
      max-height: 0;
      opacity: 0;
    }

    .mobile-input-group.show {
        max-height: 100px; 
        opacity: 1;
    }

    .delivery-charge-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-top: 1px solid #eee;
        font-weight: bold;
        color: #dc3545;
        display: none; 
    }
    
    .cart-items-list {
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .cart-item:last-child {
      border-bottom: none;
    }
    
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-btn {
      background: #dc3545;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .quantity-btn:hover {
      background: #c82333;
      transform: scale(1.1);
    }

    .quantity-btn.plus {
      background: #28a745;
    }

    .quantity-btn.plus:hover {
      background: #218838;
    }

    .cart-total {
      font-size: 1.5rem;
      font-weight: bold;
      color: #333;
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
      border-radius: 10px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      flex-direction: column;
      margin-top: 20px;
    }
    
    .action-buttons button {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
    }

    .send-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }
    
    .pdf-btn {
      background: linear-gradient(135deg, #6c757d, #495057);
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }

    .customer-info {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        animation: fadeInUp 1s ease-out 0.2s both;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .customer-info-field {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-shrink: 0;
    }
    
    .customer-details-container {
        display: flex;
        flex-grow: 1;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .customer-info label {
      font-weight: bold;
      color: #555;
      white-space: nowrap;
    }

    .customer-info input, .customer-info select {
      padding: 10px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      transition: all 0.3s ease;
      min-width: 150px;
      background-color: white;
    }
    
    .delivery-location-btn {
        background: linear-gradient(135deg, #764ba2, #667eea);
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3);
        flex-shrink: 0;
    }

    .delivery-location-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
    }
    
    .delivery-location-btn.selected {
        background: linear-gradient(135deg, #28a745, #20c997);
    }
    
    .mobile-input-group-main {
        transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
        overflow: hidden;
        max-height: 0;
        opacity: 0;
    }
    .mobile-input-group-main.show {
        max-height: 100px;
        opacity: 1;
    }
    
    .search-container {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      animation: fadeInUp 1s ease-out 0.3s both;
    }

    .search-box {
      position: relative;
      width: 100%;
    }

    .search-box input {
      width: 100%;
      padding: 15px 50px 15px 20px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }
    
    .search-box input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.3rem;
      color: #667eea;
      pointer-events: none;
    }
    
    .clear-search {
      position: absolute;
      right: 55px;
      top: 50%;
      transform: translateY(-50%);
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
      font-size: 1rem;
      display: none;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .clear-search.show {
      display: flex;
    }

    .category {
      background: rgba(255, 255, 255, 0.95);
      margin-bottom: 30px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      animation: fadeInUp 1s ease-out 0.4s both;
    }
    
    .category.new-category h2 {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .category h2 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      margin: 0;
      font-size: 1.5rem;
      text-align: center;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s ease;
    }

    .item:hover {
      background-color: #f8f9ff;
      transform: translateX(5px);
    }

    .item:last-child {
      border-bottom: none;
    }

    .item-name {
      font-weight: 500;
      font-size: 1.1rem;
      color: #333;
    }

    .item button {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    .item button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    .item button:active {
      transform: translateY(0);
    }
    
    .category.hidden {
      display: none;
    }

    .item.hidden {
      display: none;
    }

    .item.highlight {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .status-message {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
    }

    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .toast {
      position: fixed;
      top: 100px;
      right: 20px;
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(40, 167, 69, 0.4);
      z-index: 3000;
      animation: slideInRight 0.5s ease, slideOutRight 0.5s ease 2.5s;
      font-weight: bold;
      display: none;
    }

    .toast.show {
      display: block;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOutRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(100px);
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
        padding-top: 80px;
      }

      .customer-info {
        flex-direction: column;
        align-items: stretch;
      }
      
      .delivery-location-btn {
          width: 100%;
          margin-bottom: 10px;
      }
      
      .customer-details-container {
        flex-direction: column;
        gap: 10px;
        width: 100%;
      }

      .customer-info-field {
        width: 100%;
        display: block;
      }

      .customer-info input, .customer-info select {
        width: 100%;
        min-width: auto;
      }

      .item {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }

      .cart-modal-content {
        width: 95%;
      }
      
      .toast {
        right: 10px;
        left: 10px;
      }
    }
  </style>
</head>
<body>
  <button class="cart-float-btn" onclick="toggleCart()">
    üõí
    <span class="cart-badge" id="cartBadge">0</span>
  </button>

  <div class="toast" id="toast">‚úÖ Added to cart!</div>
  
  <div class="modal" id="locationModal">
    <div class="modal-content">
        <h2>Select Delivery Location</h2>
        
        <label for="hostelNameSelector" style="color: #667eea; font-size: 1.1rem;">Select Hostel Name:</label>
        <select id="hostelNameSelector">
            <option value="Table Order">Canteen Dine-In (No Delivery)</option>
            <option value="Rukmani - 1">Rukmani - 1</option>
            <option value="Rukmani - 2">Rukmani - 2</option>
            <option value="MBBS Girls Gate - 1">MBBS Girls Gate - 1</option>
            <option value="MBBS Girls Gate - 2">MBBS Girls Gate - 2</option>
            <option value="Old Boys Hostel">Old Boys Hostel</option>
            <option value="P.G Boys Hostel">P.G Boys Hostel</option>
            <option value="RAMAN House">RAMAN House</option>
            <option value="Sushrut Hostel">Sushrut Hostel</option>
            <option value="Kalpuna Hostel">Kalpuna Hostel</option>
            <option value="Rani laxmi Bai Hostel">Rani laxmi Bai Hostel</option>
        </select>

        <label for="contactNumberLocation">Contact Number (10 digits):</label>
        <input type="tel" id="contactNumberLocation" placeholder="Contact Number (Mandatory for Delivery)" maxlength="10">

        <div class="location-actions">
            <button id="cancelLocation" onclick="toggleLocationModal()">Cancel</button>
            <button id="confirmLocation" onclick="confirmDeliveryLocation()">Confirm Location</button>
        </div>
    </div>
  </div>

  <div class="modal" id="cartModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üõí Your Order</h2>
        <button class="close-modal" onclick="toggleCart()">√ó</button>
      </div>
      <div class="cart-body">
        <div class="customer-info-modal">
          <input type="hidden" id="hotelNameModal"> 
          <input type="hidden" id="tableNumberModal">
          <input type="hidden" id="contactNumberModal">
          
          <label>Location:</label>
          <input type="text" id="locationDisplayInCart" readonly style="font-weight: bold; margin-bottom: 10px;">

          <label id="tableRoomLabelModal">Table/Room Number:</label>
          <input type="text" id="tableNumberDisplayInCart" readonly style="margin-bottom: 10px;">
          
          <div class="mobile-input-group" id="contactGroupModal">
            <label>Contact Number (Delivery):</label>
            <input type="text" id="contactNumberDisplayInCart" readonly>
          </div>
        </div>

        <div class="cart-items-list" id="cartItemsList">
          <div class="empty-cart">
            <div class="empty-cart-icon">üõí</div>
            <p>Your cart is empty</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">Add items to get started!</p>
          </div>
        </div>
        
        <div class="delivery-charge-row" id="deliveryChargeRow">
            <span>Delivery Charge:</span>
            <span>‚Çπ20</span>
        </div>
        
        <div class="cart-total" id="cartTotal">Grand Total: ‚Çπ0</div>

        <div class="action-buttons">
          <button class="send-btn" onclick="sendSMS()">‚úÖ PLACE ORDER</button>
          <button class="pdf-btn" onclick="downloadPDF()">üßæ Download Bill</button>
        </div>
        <div id="statusMessage"></div>
      </div>
    </div>
  </div>

  <h1>üçΩÔ∏è MR.T Cafe</h1>
  <p class="tagline">A Taste of Home, Away from Home</p>

  <div class="customer-info">
    <button class="delivery-location-btn" id="setDeliveryLocationBtn" onclick="toggleLocationModal()">
      Set Delivery Location
    </button>
    
    <div class="customer-details-container">
        <div class="customer-info-field">
            <label id="tableRoomLabel">Table Number:</label>
            <input type="text" id="tableNumber" placeholder="Enter Table Number">
        </div>
        
        <div class="customer-info-field mobile-input-group-main" id="contactGroupMain">
            <label>Contact Number:</label>
            <input type="tel" id="contactNumber" placeholder="Enter Contact Number (10 digits)" maxlength="10">
        </div>
    </div>
    
    <input type="hidden" id="hotelName" value="Table Order"> 
  </div>

  <div class="search-container">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search for food items..." autocomplete="off">
      <button class="clear-search" id="clearSearch" onclick="clearSearch()">√ó</button>
      <span class="search-icon">üîç</span>
    </div>
    <div class="search-results-info" id="searchResultsInfo"></div>
  </div>
  
  <div class="category">
    <h2>‚òï Chai Shai</h2>
    <div class="item"><span class="item-name">Adrak Tea - ‚Çπ15</span><button onclick="addToCart('Adrak Tea', 15)">Add</button></div>
    <div class="item"><span class="item-name">Masala Tea - ‚Çπ20</span><button onclick="addToCart('Masala Tea', 20)">Add</button></div>
    <div class="item"><span class="item-name">Cinnamon Tea - ‚Çπ25</span><button onclick="addToCart('Cinnamon Tea', 25)">Add</button></div>
  </div>

  <div class="category">
    <h2>‚òï Coffee</h2>
    <div class="item"><span class="item-name">Black Coffee - ‚Çπ15</span><button onclick="addToCart('Black Coffee', 15)">Add</button></div>
    <div class="item"><span class="item-name">Classic Coffee - ‚Çπ25</span><button onclick="addToCart('Classic Coffee', 25)">Add</button></div>
    <div class="item"><span class="item-name">Chocolate Coffee - ‚Çπ40</span><button onclick="addToCart('Chocolate Coffee', 40)">Add</button></div>
    <div class="item"><span class="item-name">Hot Chocolate - ‚Çπ40</span><button onclick="addToCart('Hot Chocolate', 40)">Add</button></div>
    <div class="item"><span class="item-name">Cold Coffee - ‚Çπ89</span><button onclick="addToCart('Cold Coffee', 89)">Add</button></div>
  </div>

  <div class="category">
    <h2>ü•§ Shakes</h2>
    <div class="item"><span class="item-name">Lassi - ‚Çπ50</span><button onclick="addToCart('Lassi', 50)">Add</button></div>
    <div class="item"><span class="item-name">Butter-Scotch - ‚Çπ79</span><button onclick="addToCart('Butter Scotch', 79)">Add</button></div>
    <div class="item"><span class="item-name">Vanilla - ‚Çπ79</span><button onclick="addToCart('Vanilla', 79)">Add</button></div>
    <div class="item"><span class="item-name">Chocolate - ‚Çπ79</span><button onclick="addToCart('Chocolate', 79)">Add</button></div>
    <div class="item"><span class="item-name">Strawberry - ‚Çπ79</span><button onclick="addToCart('Strawberry', 79)">Add</button></div>
    <div class="item"><span class="item-name">Oreo - ‚Çπ89</span><button onclick="addToCart('Oreo', 89)">Add</button></div>
    <div class="item"><span class="item-name">Kit-Kat - ‚Çπ89</span><button onclick="addToCart('Kit-Kat', 89)">Add</button></div>
    <div class="item"><span class="item-name">Brownie Shake - ‚Çπ109</span><button onclick="addToCart('Brownie Shake', 109)">Add</button></div>
    <div class="item"><span class="item-name">Mango Shake - ‚Çπ60</span><button onclick="addToCart('Mango Shake', 60)">Add</button></div>
  </div>

  <div class="category">
    <h2>üßä Ice Tea</h2>
    <div class="item"><span class="item-name">Lemon Ice Tea - ‚Çπ59</span><button onclick="addToCart('Lemon Ice Tea', 59)">Add</button></div>
    <div class="item"><span class="item-name">Peach Ice Tea - ‚Çπ59</span><button onclick="addToCart('Peach Ice Tea', 59)">Add</button></div>
    <div class="item"><span class="item-name">Mint Ice Tea - ‚Çπ59</span><button onclick="addToCart('Mint Ice Tea', 59)">Add</button></div>
  </div>

  <div class="category">
    <h2>üçπ Mocktails</h2>
    <div class="item"><span class="item-name">Virgin Mojito - ‚Çπ59</span><button onclick="addToCart('Virgin Mojito', 59)">Add</button></div>
    <div class="item"><span class="item-name">Blue Lagoon - ‚Çπ59</span><button onclick="addToCart('Blue Lagoon', 59)">Add</button></div>
    <div class="item"><span class="item-name">Kala Khatta - ‚Çπ59</span><button onclick="addToCart('Kala Khatta', 59)">Add</button></div>
  </div>

  <div id="newMenuItemsContainer"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  
  <script>
    let cart = {};
    let total = 0;
    const DELIVERY_CHARGE = 20;
    const MENU_API_URL = 'https://mrt-cafe-api.onrender.com/api/menu';
    const API_BASE_URL = 'https://mrt-cafe-api.onrender.com/api/orders';
    
    let audioContext;
    let audioReady = false;
    
    function fetchMenuDataAndRender() {
        fetch(MENU_API_URL)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch new menu items.');
                }
                return response.json();
            })
            .then(data => {
                renderNewMenuItems(data);
            })
            .catch(error => {
                console.error('Error fetching dynamic menu:', error);
            });
    }

    function renderNewMenuItems(items) {
        const container = document.getElementById('newMenuItemsContainer');
        container.innerHTML = '';
        
        const categories = items.reduce((acc, item) => {
            if (!acc[item.category]) {
                acc[item.category] = {
                    emoji: item.emoji || '‚≠ê',
                    items: []
                };
            }
            acc[item.category].items.push(item);
            return acc;
        }, {});
        
        for (const catName in categories) {
            const catData = categories[catName];
            
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category new-category'; 
            categoryDiv.innerHTML = `<h2>${catData.emoji} ${catName} (New)</h2>`;
            
            catData.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.innerHTML = `
                    <span class="item-name">${item.name} - ‚Çπ${item.price}</span>
                    <button onclick="addToCart('${item.name}', ${item.price})">Add</button>
                `;
                categoryDiv.appendChild(itemDiv);
            });
            
            container.appendChild(categoryDiv);
        }
    }

    function initAudioContext() {
        if (!audioReady) {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                audioReady = true;
                document.body.removeEventListener('click', initAudioContext, { once: true });
                document.body.removeEventListener('touchend', initAudioContext, { once: true });
            } catch (e) {
                console.warn('Web Audio API not supported:', e);
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.body.addEventListener('click', initAudioContext, { once: true });
        document.body.addEventListener('touchend', initAudioContext, { once: true });
        syncCustomerInfo(); 
        fetchMenuDataAndRender();
    });

    function playSound() {
        if (audioReady && audioContext && audioContext.state === 'running') {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 700;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0.0001, audioContext.currentTime + 0.15);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            } catch (error) {
                console.error("Audio error:", error);
            }
        } else {
            initAudioContext();
        }
    }

    function showToast() {
      const toast = document.getElementById('toast');
      toast.classList.remove('show');
      void toast.offsetWidth;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function addToCart(itemName, price) {
      playSound();
      showToast();
      
      if (cart[itemName]) {
        cart[itemName].quantity += 1;
      } else {
        cart[itemName] = { price: price, quantity: 1 };
      }
      updateCartDisplay();
    }
    
    function removeFromCart(itemName) {
      if (cart[itemName] && cart[itemName].quantity > 1) {
        cart[itemName].quantity -= 1;
      } else {
        delete cart[itemName];
      }
      updateCartDisplay();
    }

    function increaseQuantity(itemName) {
      playSound();
      if (cart[itemName]) {
        cart[itemName].quantity += 1;
        updateCartDisplay();
      }
    }

    function toggleLocationModal() {
        const modal = document.getElementById('locationModal');

        if (modal.classList.contains('active')) {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        } else {
            const currentHotel = document.getElementById('hotelName').value;
            const currentContact = document.getElementById('contactNumber').value;
            const currentTable = document.getElementById('tableNumber').value; 

            document.getElementById('hostelNameSelector').value = currentHotel;
            document.getElementById('contactNumberLocation').value = currentContact;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }

    function confirmDeliveryLocation() {
        const selectedHotel = document.getElementById('hostelNameSelector').value;
        const selectedContact = document.getElementById('contactNumberLocation').value.trim();
        const isDelivery = selectedHotel !== 'Table Order';
        
        let validationError = null;

        if (isDelivery && (!selectedContact || selectedContact.length !== 10 || isNaN(selectedContact))) {
            validationError = 'Please enter a valid 10-digit Contact Number for delivery!';
        } else if (!isDelivery && !document.getElementById('tableNumber').value.trim()) {
             validationError = 'Please enter your Table Number!';
        }
        
        if (validationError) {
            alert('Error: ' + validationError);
            return;
        }

        document.getElementById('hotelName').value = selectedHotel;
        document.getElementById('tableNumber').value = isDelivery ? selectedHotel : ''; 
        document.getElementById('contactNumber').value = isDelivery ? selectedContact : '';

        const btn = document.getElementById('setDeliveryLocationBtn');
        if (isDelivery) {
            btn.textContent = `Delivery: ${selectedHotel}`;
            btn.classList.add('selected');
        } else {
            btn.textContent = 'Set Delivery Location';
            btn.classList.remove('selected');
        }

        syncCustomerInfo();
        toggleLocationModal();
    }

    function toggleContactInput() {
        const hotelName = document.getElementById('hotelName').value;
        const contactGroup = document.getElementById('contactGroupMain');
        const tableRoomLabel = document.getElementById('tableRoomLabel');
        const isDeliveryOrder = hotelName && hotelName !== 'Table Order';
        const tableInput = document.getElementById('tableNumber');

        if (isDeliveryOrder) {
            contactGroup.classList.add('show');
            tableRoomLabel.textContent = 'Hostel Name:';
            tableInput.placeholder = 'Hostel Name (Auto-set)';
            tableInput.readOnly = true; 
            tableInput.value = hotelName;
        } else {
            contactGroup.classList.remove('show');
            tableRoomLabel.textContent = 'Table Number:';
            tableInput.placeholder = 'Enter Table Number';
            tableInput.readOnly = false;
        }
        updateCartDisplay(); 
    }

    function toggleContactInputModal() {
        const hotelNameModal = document.getElementById('hotelNameModal').value;
        const contactGroupModal = document.getElementById('contactGroupModal');
        const tableRoomLabelModal = document.getElementById('tableRoomLabelModal');
        const isDeliveryOrder = hotelNameModal && hotelNameModal !== 'Table Order';

        if (isDeliveryOrder) {
            contactGroupModal.classList.add('show');
            tableRoomLabelModal.textContent = 'Hostel Name:';
        } else {
            contactGroupModal.classList.remove('show');
            tableRoomLabelModal.textContent = 'Table Number:';
        }
    }

    function syncCustomerInfo() {
      const hotel = document.getElementById('hotelName').value;
      const table = document.getElementById('tableNumber').value;
      const contact = document.getElementById('contactNumber').value;

      document.getElementById('hotelNameModal').value = hotel;
      document.getElementById('tableNumberModal').value = table;
      document.getElementById('contactNumberModal').value = contact;
      
      document.getElementById('locationDisplayInCart').value = hotel;
      document.getElementById('tableNumberDisplayInCart').value = table;
      document.getElementById('contactNumberDisplayInCart').value = contact;

      toggleContactInput();
      toggleContactInputModal();
      updateCartDisplay();
    }

    function syncCustomerInfoFromModal() {
        toggleContactInput(); 
        toggleContactInputModal(); 
        updateCartDisplay();
    }
    
    document.getElementById('tableNumber').addEventListener('input', syncCustomerInfo);
    document.getElementById('contactNumber').addEventListener('input', syncCustomerInfo);
    
    function updateCartDisplay() {
      const cartItemsDiv = document.getElementById('cartItemsList');
      const cartTotalDiv = document.getElementById('cartTotal');
      const cartBadge = document.getElementById('cartBadge');
      const deliveryRow = document.getElementById('deliveryChargeRow');
      const hotelName = document.getElementById('hotelNameModal').value;
      
      cartItemsDiv.innerHTML = '';
      total = 0;
      let totalItems = 0;

      const isDeliveryOrder = hotelName && hotelName !== 'Table Order';
      
      for (let item in cart) {
          const itemTotal = cart[item].price * cart[item].quantity;
          total += itemTotal;
          totalItems += cart[item].quantity;
          
          const cartItemDiv = document.createElement('div');
          cartItemDiv.className = 'cart-item';
          cartItemDiv.innerHTML = `
            <span>${item} (‚Çπ${cart[item].price})</span>
            <div class="quantity-controls">
              <button class="quantity-btn" onclick="removeFromCart('${item}')">‚àí</button>
              <span>${cart[item].quantity}</span>
              <button class="quantity-btn plus" onclick="increaseQuantity('${item}')">+</button>
              <span>‚Çπ${itemTotal}</span>
            </div>
          `;
          cartItemsDiv.appendChild(cartItemDiv);
      }

      let finalTotal = total;
      if (isDeliveryOrder && totalItems > 0) {
          deliveryRow.style.display = 'flex';
          finalTotal += DELIVERY_CHARGE;
      } else {
          deliveryRow.style.display = 'none';
      }

      if (Object.keys(cart).length === 0) {
        cartItemsDiv.innerHTML = `
          <div class="empty-cart">
            <div class="empty-cart-icon">üõí</div>
            <p>Your cart is empty</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">Add items to get started!</p>
          </div>
        `;
        cartBadge.textContent = '0';
        deliveryRow.style.display = 'none'; 
      } else {
        cartBadge.textContent = totalItems;
      }

      cartTotalDiv.textContent = `Grand Total: ‚Çπ${finalTotal}`;
    }

    function toggleCart() {
      const modal = document.getElementById('cartModal');
      modal.classList.toggle('active');
      if (modal.classList.contains('active')) {
        syncCustomerInfo();
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = 'auto';
      }
    }
    
    function showStatusMessage(message, isError = false) {
      const statusDiv = document.getElementById('statusMessage');
      statusDiv.innerHTML = `<div class="status-message ${isError ? 'error' : 'success'}">${message}</div>`;
      
      setTimeout(() => {
        statusDiv.innerHTML = '';
      }, 5000);
    }

    function sendSMS() {
        syncCustomerInfoFromModal();
        const hotelName = document.getElementById('hotelNameModal').value;
        const tableNumber = document.getElementById('tableNumberModal').value.trim();
        const contactNumber = document.getElementById('contactNumberModal').value.trim();
        const isDeliveryOrder = hotelName && hotelName !== 'Table Order';
        
        let validationError = null;

        if (Object.keys(cart).length === 0) {
            validationError = 'Please add items to cart!';
        } else if (isDeliveryOrder && (!contactNumber || contactNumber.length !== 10 || isNaN(contactNumber))) {
            validationError = 'Please enter a valid 10-digit Contact Number for delivery!';
        } else if (hotelName === 'Table Order' && tableNumber.length < 1) {
            validationError = 'Please enter your Table Number!';
        }

        if (validationError) {
            showStatusMessage(validationError, true);
            return;
        }

        const orderItems = Object.keys(cart).map(item => ({
            name: item,
            quantity: cart[item].quantity,
            price: cart[item].price,
            total: cart[item].price * cart[item].quantity
        }));
        
        let orderTotal = orderItems.reduce((sum, item) => sum + item.total, 0);
        
        if (isDeliveryOrder) {
            orderTotal += DELIVERY_CHARGE;
            orderItems.push({
                name: 'Delivery Charge',
                quantity: 1,
                price: DELIVERY_CHARGE,
                total: DELIVERY_CHARGE
            });
        }

        const newOrderData = {
            customerName: hotelName,
            tableNumber: tableNumber,
            contactNumber: isDeliveryOrder ? contactNumber : 'N/A',
            items: orderItems,
            total: orderTotal,
            type: isDeliveryOrder ? 'Delivery' : 'Dine-In',
            confirmed: false, 
            date: new Date().toLocaleDateString('en-GB'),
            time: new Date().toLocaleTimeString(),
            timestamp: Date.now(),
            orderNumber: Math.floor(1000 + Math.random() * 9000)
        };
        
        fetch(API_BASE_URL, { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newOrderData),
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => { throw new Error(err.message || 'Server error'); });
            }
            return response.json();
        })
        .then(data => {
            showStatusMessage('‚úÖ Order Placed Successfully! (Order #' + data.orderNumber + ')');
            
            cart = {};
            total = 0;
            
            document.getElementById('hotelName').value = 'Table Order';
            document.getElementById('tableNumber').value = '';
            document.getElementById('contactNumber').value = '';
            document.getElementById('setDeliveryLocationBtn').textContent = 'Set Delivery Location';
            document.getElementById('setDeliveryLocationBtn').classList.remove('selected');
            
            updateCartDisplay();
            syncCustomerInfo();
            toggleCart();

        })
        .catch(error => {
            console.error('Order Error:', error);
            showStatusMessage('‚ùå Order failed: ' + error.message, true);
        });
    }

    function downloadPDF() {
      syncCustomerInfoFromModal();
      const hotelName = document.getElementById('hotelNameModal').value;
      const tableNumber = document.getElementById('tableNumberModal').value;
      const contactNumber = document.getElementById('contactNumberModal').value;
      const isDeliveryOrder = hotelName && hotelName !== 'Table Order';

      if (Object.keys(cart).length === 0) {
        showStatusMessage('Cart is empty! Please add items first.', true);
        return;
      }
      
      let validationError = null;
      if (isDeliveryOrder && (!contactNumber || contactNumber.length !== 10 || isNaN(contactNumber))) {
            validationError = 'Please enter a valid 10-digit Contact Number for delivery!';
        } else if (hotelName === 'Table Order' && tableNumber.length < 1) {
            validationError = 'Please enter your Table Number!';
        }
        
        if (validationError) {
            showStatusMessage(validationError, true);
            return;
        }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      let currentTotal = Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
      let finalTotal = currentTotal;
      
      const locationLabel = isDeliveryOrder ? 'Hostel Name' : 'Table Number';
      const locationValue = tableNumber;

      doc.setFontSize(20);
      doc.setTextColor(40, 40, 40);
      doc.text('MR.T Cafe - Food Order Bill', 105, 20, { align: 'center' });

      doc.setFontSize(12);
      doc.text(`Location Type: ${hotelName === 'Table Order' ? 'Dine-In' : 'Delivery'}`, 20, 40);
      doc.text(`${locationLabel}: ${locationValue}`, 20, 50);
      
      let currentY = 60;
      if (isDeliveryOrder) {
        doc.text(`Contact: ${contactNumber}`, 20, currentY);
        currentY += 10;
      }
      
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, currentY + 10);
      doc.text(`Time: ${new Date().toLocaleTimeString()}`, 20, currentY + 20);
      
      let startY = currentY + 30;

      const tableData = [];
      for (let item in cart) {
        tableData.push([
          item,
          cart[item].quantity.toString(),
          `‚Çπ${cart[item].price}`,
          `‚Çπ${cart[item].price * cart[item].quantity}`
        ]);
      }
      
      if (isDeliveryOrder) {
        tableData.push([
          'Delivery Charge',
          '1',
          `‚Çπ${DELIVERY_CHARGE}`,
          `‚Çπ${DELIVERY_CHARGE}`
        ]);
        finalTotal += DELIVERY_CHARGE;
      }

      doc.autoTable({
        head: [['Item', 'Qty', 'Price', 'Total']],
        body: tableData,
        startY: startY,
        theme: 'grid',
        headStyles: { fillColor: [102, 126, 234] }
      });

      const finalY = doc.lastAutoTable.finalY + 10;
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.text(`Grand Total: ‚Çπ${finalTotal}`, doc.internal.pageSize.width - 10, finalY, { align: 'right' });

      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.text('Thank you for your order!', 105, finalY + 20, { align: 'center' });

      doc.save(`MRT_Cafe_Order_${hotelName}_${Date.now()}.pdf`);
      showStatusMessage('‚úÖ PDF downloaded successfully!');
    }

    document.getElementById('cartModal').addEventListener('click', function(e) {
      if (e.target.id === 'cartModal') {
        toggleCart();
      }
    });
    
    document.getElementById('locationModal').addEventListener('click', function(e) {
      if (e.target.id === 'locationModal') {
        toggleLocationModal();
      }
    });
    
    const searchInput = document.getElementById('searchInput');
    const clearSearchBtn = document.getElementById('clearSearch');
    const searchResultsInfo = document.getElementById('searchResultsInfo');

    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase().trim();
      
      if (searchTerm.length > 0) {
        clearSearchBtn.classList.add('show');
        performSearch(searchTerm);
      } else {
        clearSearchBtn.classList.remove('show');
        clearSearch();
      }
    });

    function performSearch(searchTerm) {
      const categories = document.querySelectorAll('.category');
      let foundCount = 0;

      categories.forEach(category => {
        const categoryTitle = category.querySelector('h2').textContent.toLowerCase();
        const items = category.querySelectorAll('.item');
        let categoryHasMatch = false;

        items.forEach(item => {
          const itemName = item.querySelector('.item-name').textContent.toLowerCase();
          
          if (itemName.includes(searchTerm) || categoryTitle.includes(searchTerm)) {
            item.classList.remove('hidden');
            item.classList.add('highlight');
            categoryHasMatch = true;
            foundCount++;
          } else {
            item.classList.add('hidden');
            item.classList.remove('highlight');
          }
        });

        if (categoryHasMatch) {
          category.classList.remove('hidden');
        } else {
          category.classList.add('hidden');
        }
      });

      if (foundCount > 0) {
        searchResultsInfo.textContent = `Found ${foundCount} item${foundCount > 1 ? 's' : ''} matching "${searchTerm}"`;
      } else {
        searchResultsInfo.textContent = `No items found matching "${searchTerm}"`;
      }
    }

    function clearSearch() {
      searchInput.value = '';
      clearSearchBtn.classList.remove('show');
      searchResultsInfo.textContent = '';

      const categories = document.querySelectorAll('.category');
      
      categories.forEach(category => {
        category.classList.remove('hidden');
        const items = category.querySelectorAll('.item');
        items.forEach(item => {
          item.classList.remove('hidden', 'highlight');
        });
      });
    }
  </script>
</body>
</html>
